<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.Happy100BE.Happy100.mapper.UserMapper">

    <resultMap id="userMap" type="com.Happy100BE.Happy100.entity.User">
        <id     property="userId"        column="user_id"/>
        <result property="username"      column="username"/>
        <result property="password"      column="password"/>
        <result property="name"      column="name"/>
        <result property="email"         column="email"/>
        <result property="roleId"         column="role_id"/>
        <result property="accountEnabled" column="account_enabled"/>
        <result property="createdAt"     column="created_at"/>
        <result property="roleName"     column="role_name"/>
    </resultMap>

    <insert id="insertUser" parameterType="com.Happy100BE.Happy100.entity.User"
            useGeneratedKeys="true" keyProperty="userId">
        INSERT INTO user_tb (username, password, name, email, role_id, account_enabled)
        VALUES (#{username}, #{password}, #{name}, #{email}, #{roleId}, #{accountEnabled})
    </insert>

    <select id="existsByUsername" parameterType="string" resultType="boolean">
        SELECT EXISTS(SELECT 1 FROM user_tb WHERE username = #{username})
    </select>

    <select id="existsByEmail" parameterType="string" resultType="boolean">
        SELECT EXISTS(SELECT 1 FROM user_tb WHERE email = #{email})
    </select>

    <select id="findByUsername" parameterType="string" resultMap="userMap">
        SELECT u.*, r.role_name
        FROM user_tb u
        JOIN role_tb r ON r.role_id = u.role_id
        WHERE u.username = #{username}
        LIMIT 1
    </select>

</mapper>
